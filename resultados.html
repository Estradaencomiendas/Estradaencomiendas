<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resultados del Paquete</title>
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs2@0.0.2/qrcode.min.js"></script>
    <!-- Firebase (Versión 8.x) -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script>
        // Configuración de Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyA42b2B9K4J8BMWa9FfHXFu2sAR0aFYm-M",
            authDomain: "estradaencomiendas0.firebaseapp.com",
            projectId: "estradaencomiendas0",
            storageBucket: "estradaencomiendas0.appspot.com",
            messagingSenderId: "247979951336",
            appId: "1:247979951336:web:92b6b4bf615595676755d",
            measurementId: "G-BRMC9FZBC"
        };

        // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        // Función para obtener el número de seguimiento de la URL
        function getQueryParams() {
            const params = new URLSearchParams(window.location.search);
            return {
                trackingNumber: params.get('trackingNumber')
            };
        }

        // Función para mostrar los detalles del paquete desde Firestore
        function displayPackageDetails(packageData) {
            const packageDetailsElement = document.getElementById('package-details');
            if (!packageDetailsElement) {
                console.error('Elemento package-details no encontrado');
                return;
            }
    
            packageDetailsElement.innerHTML = `
                <p><span>Número de Seguimiento:</span> ${packageData.trackingNumber}</p>
                <p><span>Nombre de la Clienta:</span> ${packageData.nombreCliente}</p>
                <p><span>Nombre del Paquete:</span> ${packageData.nombrePaquete}</p>
                <p><span>Destino:</span> ${packageData.destino}</p>
                <p><span>Fecha de Envío:</span> ${packageData.fechaEnvio}</p>
                <p><span>Fecha de Entrega:</span> ${packageData.diaEntrega}</p>
                <p><span>Valor:</span> $${packageData.valor}</p>
            `;

            // Generar el código QR
            new QRCode(document.getElementById("qrcode"), {
                text: packageData.trackingNumber,
                width: 128,
                height: 128,
                colorDark: "#000000",
                colorLight: "#ffffff",
                correctLevel: QRCode.CorrectLevel.H
            });
        }

        // Función para obtener los datos del paquete desde Firestore
        async function fetchPackageDetails(trackingNumber) {
            try {
                const doc = await db.collection('paquetes').doc(trackingNumber).get();
                if (doc.exists) {
                    displayPackageDetails(doc.data());
                } else {
                    document.getElementById('package-details').innerHTML = '<p>No se encontraron datos del paquete.</p>';
                }
            } catch (error) {
                console.error('Error obteniendo los datos del paquete:', error);
            }
        }

        // Al cargar la página, obtener los datos del paquete desde Firestore
        document.addEventListener('DOMContentLoaded', function() {
            auth.onAuthStateChanged(function(user) {
                if (user) {
                    const { trackingNumber } = getQueryParams();
                    if (trackingNumber) {
                        fetchPackageDetails(trackingNumber);
                    } else {
                        document.getElementById('package-details').innerHTML = '<p>No se encontró el número de seguimiento.</p>';
                    }
                } else {
                    console.log('Redirigiendo a login...');
                    window.location.href = 'login.html';
                }
            });
        });

        // Función para imprimir el ticket
        function printTicket() {
            window.print();
        }

        // Función para regresar a la página de Recepción de Paquetes
        function goBack() {
            window.location.href = 'Recepcion de Paquetes.html';
        }
    </script>
    <style>
        /* Estilos omitidos para mantener la respuesta concisa */
    </style>
</head>
<body>
    <!-- Contenido omitido -->
</body>
</html>
