<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resultados del Paquete</title>
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs2@0.0.2/qrcode.min.js"></script>
    <!-- Firebase (Versión 8.x) -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script>
        // Configuración de Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyA42b2B9K4J8BMWa9FfHXFu2sAR0aFYm-M",
            authDomain: "estradaencomiendas0.firebaseapp.com",
            projectId: "estradaencomiendas0",
            storageBucket: "estradaencomiendas0.appspot.com",
            messagingSenderId: "247979951336",
            appId: "1:247979951336:web:92b6b4bf615595676755d",
            measurementId: "G-BRMC9FZBC"
        };

        // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
    </script>
    <style>
        /* Estilos... */
    </style>
</head>
<body>
    <div class="container">
        <img src="logo-bn.png" alt="Logo Estrada Encomiendas" class="logo">
        <h1>Detalles del Paquete</h1>
        <div class="data">
            <div id="package-details"></div>
            <div id="qrcode"></div>
        </div>
        <button id="print-button" onclick="printTicket()">Imprimir Ticket</button>
        <button id="back-button" onclick="goBack()">Regresar</button>

        <script>
            function getQueryParams() {
                const params = new URLSearchParams(window.location.search);
                return {
                    trackingNumber: params.get('trackingNumber')
                };
            }

            function displayPackageDetails(packageData) {
                document.getElementById('package-details').innerHTML = `
                    <p><span>Número de Seguimiento:</span> ${packageData.trackingNumber}</p>
                    <p><span>Nombre de la Clienta:</span> ${packageData.nombreCliente}</p>
                    <p><span>Destino:</span> ${packageData.destino}</p>
                `;

                // Generar solo el número de seguimiento en el QR
                new QRCode(document.getElementById("qrcode"), {
                    text: packageData.trackingNumber, // Solo el número de seguimiento
                    width: 128,
                    height: 128,
                    colorDark: "#000000",
                    colorLight: "#ffffff",
                    correctLevel: QRCode.CorrectLevel.H
                });
            }

            async function fetchPackageDetails(trackingNumber) {
                try {
                    const doc = await db.collection('paquetes').where("trackingNumber", "==", trackingNumber).get();
                    if (!doc.empty) {
                        doc.forEach(docSnap => displayPackageDetails(docSnap.data()));
                    } else {
                        document.getElementById('package-details').innerHTML = '<p>No se encontraron datos del paquete.</p>';
                    }
                } catch (error) {
                    console.error('Error obteniendo los datos del paquete:', error);
                }
            }

            document.addEventListener('DOMContentLoaded', function() {
                const { trackingNumber } = getQueryParams();
                if (trackingNumber) {
                    fetchPackageDetails(trackingNumber);
                } else {
                    document.getElementById('package-details').innerHTML = '<p>No se encontró el número de seguimiento.</p>';
                }
            });

            function printTicket() {
                window.print();
            }

            function goBack() {
                window.location.href = 'Recepcion de Paquetes.html';
            }
        </script>
    </div>
</body>
</html>


